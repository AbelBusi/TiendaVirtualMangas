<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>WEbStorm</title>
    <meta name='viewport' content='user-scalable=no, width=device-width, initial-scale=1'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          crossorigin="anonymous">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

    <link rel="shortcut icon" th:href="@{/media/images/iconos/iconoOnePieceCHAD.png}" />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.bootstrap5.min.css">

    <link rel="stylesheet" th:href="@{/css/carrusel.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/letras.css}">
    <link rel="stylesheet" th:href="@{/css/card.css}">
    <link rel="stylesheet" th:href="@{/css/apiContainer.css}">
    <link rel="stylesheet" th:href="@{/css/mangas.css}">
    <link rel="stylesheet" th:href="@{/css/botones.css}">

    <style>
        .form-control:focus {
            border-color: #FFC107;
            box-shadow: 0 0 0 0.2rem rgba(255, 193, 7, .25);
        }

        .btn-warning:hover {
            background-color: #e0a800;
            border-color: #d39e00;
        }

        main {
            font-family: 'Poppins';
        }

        .card img {
            object-fit: cover;
            height: 200px;
        }

        h1,
        h2,
        h3 {
            text-shadow: 1px 1px 2px #000;
        }
    </style>

</head>

<body>


<div th:replace="components/header :: mainHeader"></div>

<main class="container my-5">
    <div class="text-center mb-5">
        <p id="descripcionBanner" class="lead">Cargando...</p>
        <img src="../assets/media/images/slider/756730.jpg" class="img-fluid rounded shadow-sm mt-3"
             alt="Contacto Anime">
    </div>

    <div class="row g-5">
        <div class="col-lg-6">
            <div class="card shadow-sm border-0 rounded-3">
                <div class="card-body p-4 p-md-5">
                    <h3 id="tituloFormulario" class="text-warning mb-4">Cargando Título...</h3>
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="name" class="form-label fw-bold">Nombre</label>
                            <input type="text" class="form-control" id="name" placeholder="Tu nombre" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label fw-bold">Correo electrónico</label>
                            <input type="email" class="form-control" id="email" placeholder="tucorreo@ejemplo.com"
                                   required>
                        </div>
                        <div class="mb-3">
                            <label for="subject" class="form-label fw-bold">Asunto</label>
                            <input type="text" class="form-control" id="subject" placeholder="Asunto de tu mensaje"
                                   required>
                        </div>
                        <div class="mb-3">
                            <label for="message" class="form-label fw-bold">Mensaje</label>
                            <textarea class="form-control" id="message" rows="5"
                                      placeholder="Escribe tu mensaje aquí..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-warning fw-bold w-100">Enviar Mensaje</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card shadow-sm border-0 rounded-3 p-4">
                <h3 id="tituloSobreNosotros" class="text-warning mb-4">Cargando Título...</h3>
                <p id="descripcionCompania">Cargando descripción...</p>
                <img src="../assets/media/images/mangas/Haruka_17_09.jpg" class="img-fluid rounded mt-3 mb-3"
                     alt="Sobre Nosotros">
                <p class="fw-bold">Misión:</p>
                <p id="mision">Cargando misión...</p>
                <p class="fw-bold">Visión:</p>
                <p id="vision">Cargando visión...</p>
            </div>
        </div>
    </div>

    <div class="my-5 text-center">
        <h2 id="tituloEquipo" class="text-warning mb-4">Cargando Equipo...</h2>
        <div id="equipoContainer" class="row g-4 justify-content-center">
        </div>
    </div>
</main>

<div th:replace="~{components/footer :: footerReplace}"></div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFpRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.bootstrap5.min.js"></script>

<script th:src="@{/js/movimiento.js}"></script>


<script>
        const API_URL = 'http://localhost:8007/';

        // Función para renderizar dinámicamente el contenido del equipo
        function renderizarEquipo(miembros) {
            const container = document.getElementById('equipoContainer');
            container.innerHTML = ''; // Limpiar el contenido de "Cargando Equipo..."

            miembros.forEach(miembro => {
                // Generamos los iconos de redes sociales usando las clases de Font Awesome de la API
                const redesHTML = miembro.redes.map(iconClass =>
                    `<a href="#" class="text-warning mx-1"><i class="${iconClass}"></i></a>`
                ).join('');

                const cardHTML = `
                    <div class="col-sm-6 col-md-4 col-lg-3">
                        <div class="card shadow-sm border-0">
                            <img src="${miembro.imagen}" class="card-img-top" alt="${miembro.nombre}">
                            <div class="card-body text-center">
                                <h5 class="card-title">${miembro.nombre}</h5>
                                <p class="card-text">${miembro.rol}</p>
                                <div>
                                    ${redesHTML}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHTML;
            });
        }


        // Función principal para obtener y mostrar los datos
        async function cargarDatosDesdeAPI() {
            try {
                // 1. Petición a la API de Node.js
                const response = await fetch(API_URL);

                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }

                const data = await response.json();

                // 2. Inyectar datos de Contacto
                document.getElementById('descripcionBanner').textContent = data.seccionContacto.descripcionBanner;
                document.getElementById('tituloFormulario').textContent = data.seccionContacto.tituloPrincipal;

                // 3. Inyectar datos Sobre Nosotros
                document.getElementById('tituloSobreNosotros').textContent = data.seccionSobreNosotros.titulo;
                document.getElementById('descripcionCompania').textContent = data.seccionSobreNosotros.descripcionGeneral;
                document.getElementById('mision').textContent = data.seccionSobreNosotros.mision;
                document.getElementById('vision').textContent = data.seccionSobreNosotros.vision;

                // 4. Inyectar datos del Equipo
                document.getElementById('tituloEquipo').textContent = data.seccionEquipo.titulo;
                renderizarEquipo(data.seccionEquipo.miembros);

            } catch (error) {
                console.error("❌ Error al cargar datos desde la API:", error);

                // Mostrar un mensaje de error visible al usuario si falla la API
                document.getElementById('tituloEquipo').innerHTML = `
                    <h2 class="text-danger">Error de Conexión:</h2>
                    <p class="lead text-dark">Asegúrate que <strong>server.js</strong> esté corriendo en ${API_URL}</p>`;
            }
        }

        // Ejecutar la carga de datos al iniciar la página
        window.addEventListener('load', cargarDatosDesdeAPI);


        // Manejo del formulario con SweetAlert2 (se mantiene)
        const contactForm = document.getElementById('contactForm');
        contactForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const subject = document.getElementById('subject').value;

            // Simular el envío de datos de contacto
            Swal.fire({
                title: '¡Mensaje enviado!',
                html: `<p>Gracias <strong>${name}</strong>, hemos recibido tu mensaje:</p><p><em>${subject}</em></p>`,
                icon: 'success',
                confirmButtonText: 'Cerrar',
                confirmButtonColor: '#FFC107'
            });

            contactForm.reset();
        });
    </script>

</body>

</html>