<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Hero - Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/assets/css/bootstrap.css}">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/assets/css/app.css}">
  <link rel="stylesheet" th:href="@{/assets/vendors/perfect-scrollbar/perfect-scrollbar.css}">
  <link rel="stylesheet" th:href="@{/assets/vendors/bootstrap-icons/bootstrap-icons.css}">
  <link rel="stylesheet" th:href="@{/css/bodyTransparent.css}">
  <link rel="stylesheet" th:href="@{/css/botonesAdmin.css}">

  <link rel="shortcut icon" th:href="@{/media/images/iconos/iconoOnePieceCHAD.png}" />

  <style>
        body {
            /* ... (Estilos de body aquí) ... */
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: #fff;
        }
        .card-header { border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .input-anime, .form-control { color: #212529; background-color: #f8f9fa; }
        .input-anime:focus { border-color: #ffc107; box-shadow: 0 0 0 0.25rem rgba(255, 193, 7, 0.25); }
    </style>
</head>

<body th:style="'background-image: url(' + @{/media/images/iconos/fondoBpdy.jpg} + ')'">
<div id="app">
  <div th:replace="~{components/header :: siderAdmin}"></div>

  <div id="main">
    <header class="mb-3">
      <a href="#" class="burger-btn d-block d-xl-none">
        <i class="bi bi-justify fs-3"></i>
      </a>
    </header>

    <div class="page-heading">
      <div class="page-title">
        <div class="row">
          <div class="col-12">
            <h3>GESTIÓN DEL BANNER PRINCIPAL (HERO)</h3>
          </div>
        </div>
      </div>

      <section class="section mt-3">
        <div class="row justify-content-center">
          <div class="col-md-8">
            <div class="card bg-transparent border-warning">
              <div class="card-header">
                <h4 class="card-title text-white">Editar Contenido del Banner</h4>
              </div>
              <div class="card-content">
                <div class="card-body">
                  <form id="formHeroEdit" class="form">
                    <div class="row">
                      <div class="col-12 mb-3">
                        <label for="hero_title" class="form-label text-white">Título Principal</label>
                        <input type="text" id="hero_title" class="form-control input-anime" name="title" required>
                      </div>
                      <div class="col-12 mb-3">
                        <label for="hero_description" class="form-label text-white">Descripción</label>
                        <textarea id="hero_description" class="form-control input-anime" name="description" rows="3" required></textarea>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="hero_link_text" class="form-label text-white">Texto del Enlace</label>
                        <input type="text" id="hero_link_text" class="form-control input-anime" name="link_text" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="hero_link" class="form-label text-white">URL del Enlace</label>
                        <input type="url" id="hero_link" class="form-control input-anime" name="link" required>
                      </div>
                      <div class="col-12 mb-3">
                        <label for="hero_meta" class="form-label text-white">Meta (Texto pequeño)</label>
                        <input type="text" id="hero_meta" class="form-control input-anime" name="meta" required>
                      </div>
                    </div>
                    <div class="col-12 d-flex justify-content-end">
                      <button type="submit" class="btn btn-anime w-100 fw-bold">Guardar Cambios</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <footer>
      <div class="footer clearfix mb-0 text-muted">
      </div>
    </footer>
  </div>
</div>

<script th:src="@{/assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js}"></script>
<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/js/main.js}"></script>

<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>
        const API_BASE_URL = "http://localhost:3008/api";

        // 1. Cargar los datos actuales
        async function loadHeroData() {
            try {
                const response = await fetch(`${API_BASE_URL}/hero`);
                const data = await response.json();

                if (data) {
                    $('#hero_title').val(data.title);
                    $('#hero_description').val(data.description);
                    $('#hero_link_text').val(data.link_text);
                    $('#hero_link').val(data.link);
                    $('#hero_meta').val(data.meta);
                }
            } catch (error) {
                console.error("Error al cargar datos del Hero:", error);
                Swal.fire('Error de Carga', 'No se pudieron obtener los datos actuales del Hero.', 'error');
            }
        }

        // 2. Manejar el envío del formulario (PUT)
        $('#formHeroEdit').on('submit', async function(e) {
            e.preventDefault();

            // Recolectar datos del formulario
            const updatedData = {
                title: $('#hero_title').val(),
                description: $('#hero_description').val(),
                link_text: $('#hero_link_text').val(),
                link: $('#hero_link').val(),
                meta: $('#hero_meta').val()
            };

            try {
                const response = await fetch(`${API_BASE_URL}/hero`, {
                    method: 'PUT', // Usamos PUT para actualizar el objeto simple
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updatedData)
                });

                if (response.ok) {
                    Swal.fire('¡Éxito!', 'El Banner principal (Hero) ha sido actualizado correctamente.', 'success');
                } else {
                    const error = await response.json();
                    Swal.fire('Error', error.message || 'Error al actualizar el Hero.', 'error');
                }
            } catch (error) {
                console.error("Error de conexión al guardar:", error);
                Swal.fire('Error de Conexión', 'No se pudo conectar con la API para guardar los cambios.', 'error');
            }
        });


        // Cargar datos al iniciar
        $(document).ready(function () {
            loadHeroData();
        });
    </script>
</body>

</html>