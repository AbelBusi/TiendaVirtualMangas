<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Manga Store | Cat√°logo de Libros</title>
    <meta name='viewport' content='user-scalable=no, width=device-width, initial-scale=1'>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

    <link rel="shortcut icon" th:href="@{/media/images/iconos/iconoOnePieceCHAD.png}" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" th:href="@{/css/carrusel.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/letras.css}">
    <link rel="stylesheet" th:href="@{/css/card.css}">
    <link rel="stylesheet" th:href="@{/css/libroDetalle.css}">
    <link rel="stylesheet" th:href="@{/css/botones.css}">

    <style>
        :root {
            --primary-color: #007bff;
            --accent-color: #28a745;
            --text-dark: #343a40;
            --bg-light: #f8f9fa;
        }

        .text-custom-primary { color: var(--primary-color) !important; }
        .btn-primary-custom {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .btn-primary-custom:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

        /* CARD COMPACTA: Dise√±o */
        .imageCard {
            height: 200px;
            object-fit: cover;
        }
        .card-product-compact {
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid #dee2e6;
            border-radius: 0;
        }
        .card-product-compact:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
        }
        .card-footer-compact {
            padding: 0.5rem 0.75rem;
            border-top: none;
        }

        /* SIDEBAR DE FILTROS (STICKY) */
        #filterSidebar {
            position: sticky;
            top: 80px; /* Se queda fijo debajo del header */
            height: fit-content;
            padding: 0;
            border-radius: 0.25rem;
            z-index: 10;
        }

        /* Eliminamos los estilos de #searchBarFixedWrapper y #mainSearchBarContainer */

        /* Ajustes para la galer√≠a */
        #mangaGallery {
             padding-top: 1rem;
        }

        /* Ocultar Sidebar en m√≥viles */
        @media (max-width: 991.98px) {
            #filterSidebar {
                display: none !important;
            }
        }
    </style>
</head>

<body>

<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header border-bottom">
        <h5 id="offcanvasRightLabel" class="fw-bold text-dark">Carrito de Compras</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
        <div class="card mb-3 shadow-sm border rounded-3">
            <div class="row g-0 align-items-center">
                <div class="col-4">
                    <img th:src="@{/media/images/mangas/Haruka_17_09.jpg}" class="img-fluid rounded-start"
                         alt="Portada libro" style="object-fit: cover; height: 100%;">
                </div>
                <div class="col-8">
                    <div class="card-body p-2">
                        <h6 class="card-title fw-semibold mb-1">Doraemon Vol. 1</h6>
                        <p class="text-muted small mb-2">Precio: <span class="fw-bold text-dark">S/ 25.00</span></p>
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">Cant.</span>
                            <input type="number" class="form-control" value="1" min="1">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-auto border-top pt-3">
            <div class="d-flex justify-content-between mb-3">
                <span class="fw-semibold">Total:</span>
                <span class="fw-bold fs-5 text-dark" id="totalCarrito">S/ 25.00</span>
            </div>
            <div class="d-grid">
                <a class="btn btn-success fw-bold" th:href="@{/tienda/pagar}"><i class="bi bi-bag-check me-1"></i> Finalizar
                    compra</a>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{components/header :: mainHeader}"></div>

<div class="offcanvas offcanvas-start" tabindex="-1" id="filterOffcanvas" aria-labelledby="filterOffcanvasLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title fw-bold" id="filterOffcanvasLabel"><i class="bi bi-funnel me-2"></i> Filtrar Productos</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-3">
        <div class="accordion accordion-flush" id="mobileAccordionFilters">

            <div class="accordion-item card shadow-sm mb-3">
                <h2 class="accordion-header" id="mobileHeadingBusqueda">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#mobileCollapseBusqueda" aria-expanded="true" aria-controls="mobileCollapseBusqueda">
                        Buscar
                    </button>
                </h2>
                <div id="mobileCollapseBusqueda" class="accordion-collapse collapse show" aria-labelledby="mobileHeadingBusqueda" data-bs-parent="#mobileAccordionFilters">
                    <div class="accordion-body p-3">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="T√≠tulo, Autor..." id="searchInputMobile">
                            <button class="btn btn-primary-custom" type="button" id="searchButtonMobile"><i class="bi bi-search"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion-item card shadow-sm mb-3">
                <h2 class="accordion-header" id="mobileHeadingCategoria">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mobileCollapseCategoria" aria-expanded="false" aria-controls="mobileCollapseCategoria">
                        G√©nero
                    </button>
                </h2>
                <div id="mobileCollapseCategoria" class="accordion-collapse collapse" aria-labelledby="mobileHeadingCategoria" data-bs-parent="#mobileAccordionFilters">
                    <div class="accordion-body p-3">
                        <div class="form-check" th:each="libro : ${librosActivos}">
                            <input class="form-check-input filter-checkbox-category-mobile" type="checkbox"
                                   th:value="${libro.nombreTipoLibro}"
                                   th:id="'mob-cat-' + ${libro.nombreTipoLibro}">
                            <label class="form-check-label small" th:for="'mob-cat-' + ${libro.nombreTipoLibro}" th:text="${libro.nombreTipoLibro}">
                                Shonen
                            </label>
                        </div>
                        <button class="btn btn-sm btn-outline-secondary w-100 mt-3" id="clearCategoryFilterMobile">Limpiar</button>
                    </div>
                </div>
            </div>

            <div class="accordion-item card shadow-sm mb-3">
                <h2 class="accordion-header" id="mobileHeadingPrecio">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mobileCollapsePrecio" aria-expanded="false" aria-controls="mobileCollapsePrecio">
                        Precio
                    </button>
                </h2>
                <div id="mobileCollapsePrecio" class="accordion-collapse collapse" aria-labelledby="mobileHeadingPrecio" data-bs-parent="#mobileAccordionFilters">
                    <div class="accordion-body p-3">
                        <select class="form-select form-select-sm filter-select-mobile" id="filterPrecioMobile">
                            <option value="0-9999" selected>Cualquier precio</option>
                            <option value="0-10">Menos de S/ 10</option>
                            <option value="10-20">S/ 10 - S/ 20</option>
                            <option value="20-50">S/ 20 - S/ 50</option>
                            <option value="50-100">S/ 50 - S/ 100</option>
                            <option value="100-9999">M√°s de S/ 100</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="accordion-item card shadow-sm mb-3">
                <h2 class="accordion-header" id="mobileHeadingOrdenar">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mobileCollapseOrdenar" aria-expanded="false" aria-controls="mobileCollapseOrdenar">
                        Ordenar por
                    </button>
                </h2>
                <div id="mobileCollapseOrdenar" class="accordion-collapse collapse" aria-labelledby="mobileHeadingOrdenar" data-bs-parent="#mobileAccordionFilters">
                    <div class="accordion-body p-3">
                        <select class="form-select form-select-sm" id="sortSelectMobile">
                            <option value="relevance" selected>Relevancia</option>
                            <option value="price_asc">Precio (Menor a Mayor)</option>
                            <option value="price_desc">Precio (Mayor a Menor)</option>
                            <option value="name_asc">T√≠tulo (A-Z)</option>
                        </select>
                    </div>
                </div>
            </div>

        </div>

        <div class="d-grid p-2 mt-4">
            <button class="btn btn-primary-custom fw-bold btn-lg" id="applyFiltersBtnMobile" data-bs-dismiss="offcanvas">
                <i class="bi bi-check-circle me-1"></i> Aplicar Filtros
            </button>
        </div>
    </div>
</div>

<section class="py-4 bg-white">
    <div class="container-fluid">

        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none text-dark">Inicio</a></li>
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none text-dark">Comics y Mangas</a></li>
                <li class="breadcrumb-item active" aria-current="page">Cat√°logo</li>
            </ol>
        </nav>

        <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
            <h1 class="text-dark fw-light mb-0">CAT√ÅLOGO DE LIBROS</h1>
            <span class="fw-semibold small text-muted d-block d-md-block d-lg-none" id="resultsCountMobile">
                Mostrando <span th:text="${#lists.size(librosActivos)}">50</span> productos.
            </span>
        </div>

        <div class="row g-4">

            <div class="col-lg-3 col-xl-2 d-none d-lg-block">
                <div class="card shadow-sm border" id="filterSidebar">

                    <div class="filter-header p-3">
                        <h5 class="mb-0 fw-bold text-dark"><i class="bi bi-sliders me-2"></i> Filtros</h5>
                        <hr class="my-2">
                        <div class="fw-semibold small text-muted">
                            <span id="resultsCountDesktop">Mostrando <span th:text="${#lists.size(librosActivos)}">50</span> productos.</span>
                        </div>
                    </div>

                    <div class="accordion accordion-flush" id="accordionFilters">

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingBusqueda">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBusqueda" aria-expanded="true" aria-controls="collapseBusqueda">
                                    Buscar
                                </button>
                            </h2>
                            <div id="collapseBusqueda" class="accordion-collapse collapse show" aria-labelledby="headingBusqueda" data-bs-parent="#accordionFilters">
                                <div class="accordion-body p-2">
                                    <div class="input-group input-group-sm">
                                        <input type="text" class="form-control" placeholder="T√≠tulo o Autor..." id="searchInputDesktop">
                                        <button class="btn btn-primary-custom" type="button" id="searchButtonDesktop"><i class="bi bi-search"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingCategoria">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCategoria" aria-expanded="false" aria-controls="collapseCategoria">
                                    G√©nero
                                </button>
                            </h2>
                            <div id="collapseCategoria" class="accordion-collapse collapse" aria-labelledby="headingCategoria" data-bs-parent="#accordionFilters">
                                <div class="accordion-body p-2">
                                    <div class="form-check" th:each="libro : ${librosActivos}">
                                        <input class="form-check-input filter-checkbox-category" type="checkbox"
                                               th:value="${libro.nombreTipoLibro}"
                                               th:id="'cat-' + ${libro.nombreTipoLibro}">
                                        <label class="form-check-label small" th:for="'cat-' + ${libro.nombreTipoLibro}" th:text="${libro.nombreTipoLibro}">
                                            Shonen
                                        </label>
                                    </div>
                                    <button class="btn btn-sm btn-outline-secondary w-100 mt-2" id="clearCategoryFilter">Limpiar</button>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingPrecio">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePrecio" aria-expanded="false" aria-controls="collapsePrecio">
                                    Precio
                                </button>
                            </h2>
                            <div id="collapsePrecio" class="accordion-collapse collapse" aria-labelledby="headingPrecio" data-bs-parent="#accordionFilters">
                                <div class="accordion-body p-2">
                                    <select class="form-select form-select-sm filter-select" id="filterPrecio">
                                        <option value="0-9999" selected>Cualquier precio</option>
                                        <option value="0-10">Menos de S/ 10</option>
                                        <option value="10-20">S/ 10 - S/ 20</option>
                                        <option value="20-50">S/ 20 - S/ 50</option>
                                        <option value="50-100">S/ 50 - S/ 100</option>
                                        <option value="100-9999">M√°s de S/ 100</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOrdenar">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOrdenar" aria-expanded="false" aria-controls="collapseOrdenar">
                                    Ordenar por
                                </button>
                            </h2>
                            <div id="collapseOrdenar" class="accordion-collapse collapse" aria-labelledby="headingOrdenar" data-bs-parent="#accordionFilters">
                                <div class="accordion-body p-2">
                                    <select class="form-select form-select-sm" id="sortSelectDesktop">
                                        <option value="relevance" selected>Relevancia</option>
                                        <option value="price_asc">Precio (Menor a Mayor)</option>
                                        <option value="price_desc">Precio (Mayor a Menor)</option>
                                        <option value="name_asc">T√≠tulo (A-Z)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="d-grid p-3 border-top">
                        <button class="btn btn-primary-custom fw-bold btn-sm" id="applyFiltersBtn">
                            <i class="bi bi-check-circle me-1"></i> Aplicar
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-lg-9 col-xl-10 col-12">

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <button class="btn btn-outline-secondary d-lg-none me-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#filterOffcanvas" aria-controls="filterOffcanvas">
                        <i class="bi bi-funnel me-1"></i> Filtrar & Buscar
                    </button>
                    <div class="d-none d-lg-block d-xl-block">
                        <div class="fw-semibold small text-muted">
                            Ordenar por: <span class="fw-bold" id="currentSortDesktop">Relevancia</span>
                        </div>
                    </div>
                </div>

                <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-4 row-cols-xl-5 g-3" id="mangaGallery">

                    <div class="col" th:each="libro : ${librosActivos}"
                         th:data-category="${libro.nombreTipoLibro}"
                         th:data-price="${libro.precio}"
                         th:data-name="${libro.titulo}"
                         th:data-is-offer="false">

                        <div class="card h-100 card-product-compact shadow-sm border-0">

                            <a th:href="@{/tienda/libros/{idLibro}(idLibro=${libro.idLibro})}" class="text-decoration-none text-dark">
                                <img th:src="@{'/media/images/store/' + ${libro.portadaUrl}}"
                                     class="card-img-top imageCard"
                                     th:alt="${libro.titulo}">
                            </a>

                            <div class="card-body d-flex flex-column p-2 pt-1">
                                <h6 class="card-title fw-semibold mb-1 small text-truncate" th:text="${libro.titulo}">T√≠tulo del Libro</h6>
                                <p class="card-text small text-muted mb-2 text-truncate" th:text="${libro.autor}">Autor</p>

                                <div class="mt-auto">
                                    <span class="fw-bolder fs-6 text-dark">S/ <span th:text="${#numbers.formatDecimal(libro.precio, 1, 2)}">25.00</span></span>
                                </div>
                            </div>

                            <div class="card-footer-compact d-flex justify-content-center bg-white border-top">
                                <button class="btn btn-sm btn-primary-custom w-100" type="button" data-bs-toggle="offcanvas"
                                        data-bs-target="#offcanvasRight" aria-controls="offcanvasRight" th:data-libro-id="${libro.idLibro}">
                                    <i class="bi bi-cart-plus me-1"> </i> A√±adir
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 text-center mt-5" id="noResultsMessage" style="display:none;">
                        <h3 class="text-muted">üò¢ No encontramos productos.</h3>
                        <p>Ajusta tus filtros y tu b√∫squeda.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div th:replace="~{components/footer :: footerReplace}"></div>


<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>




<script th:src="@{/js/manga1.js}"></script>


</body>
</html>